# 账户同步常见问题
## 账户同步的两种方式是什么？有什么区别？
Portal平台支持以下两种账户同步方式：
- 业务系统通过Portal提供的基于SCIM协议的接口将账户同步到Portal平台。
- Portal平台通过应用系统（SP）提供的接口将在Portal中创建的接口同步到SP中。

这两种方式的区别在于谁接收传过来的账户、谁提供接口。

> ❓ **说明** 接口需基于SCIM协议开发。

## 如果两个子系统中存在相同的账户名，同步到Portal平台会如何处理？如果用户在两个系统中的账户名不相同，同步到Portal平台会如何处理？
子业务系统同步到Portal平台时，会携带一个唯一标识的参数，Portal平台根据该唯一标识来判断是不是同一个账户。如果唯一标识相同则相互关联；如果不同则创建一个新的账户。

Portal中会有主账户和子账户， 同时保留二者的关联关系。 两个子账户， 可以通过某种主子账户共同的关联属性， 可以映射到同一个主账户。

> ❓ **说明** 唯一标识一般使用账号绑定的邮箱或手机号。

## Ｑ：Portal推数据到SP的方式，是推送的增量数据还是全量数据？

Ａ：Portal推数据到SP的数据采用的是增量的方式

## Ｑ：Portal推数据到SP如何保证安全与数据事务性？

Ａ：Portal推数据到SP这种方式同支付回调场景原理一致，需要业务系统正确处理之后，响应成功的状态码（200），才会认为这是一次正常的回调并记录日志。

<font color=red>**注意：**</font>

1、同样的通知可能会多次发送给业务系统。业务系统必须能够正确处理重复的通知。

2、后台通知交互时，如果Portal收到业务的应答不符合规范或超时，Portal会判定本次通知失败，重新发送通知，直到成功为止（在通知一直不成功的情况下，Portal总共会发起多次通知，通知频率为15s/15s/30s/3m/10m/20m/30m/30m/30m/60m/3h/3h/3h/6h/6h - 总计 24h4m），但Portal不保证通知最终一定能成功。

3、当收到通知进行处理时，首先检查对应业务数据的状态，判断该通知是否已经处理过，如果没有处理过再进行处理，如果处理过直接返回结果成功。在对业务数据进行状态检查和处理之前，要采用数据锁进行并发控制，以避免函数重入造成的数据混乱。