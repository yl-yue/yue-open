# Portal推数据到SP(第三方应用)
此同步方式，需要SP提供接口API。Portal通过调用这些API将数据同步到SP。其中需要注意的就是这个接口需要业务系统根据我们提供的字段名称和错误返回码来进行开发，此接口的开发需要提供Basic协议或者Oauth协议来保护接口。以下，我们将常用的API按照 组织机构，账户，组进行分类。

`Portal请求SP所有的地址都基于在IT管理员应用处的SCIM配置的地址基础上，以不同的请求方式(POST,PUT,DELETE)请求该地址。`

## 接口列表
以下是关于组织机构操作的API，包括：
- Portal给SP添加组织机构
- Portal给SP修改或移动组织机构
- Portal给SP删除组织机构

以下是关于账户操作的API，包括：

- Portal给SP添加账户
- Portal给SP修改或移动账户
- Portal给SP删除账户

以下是关于组操作的API，包括：

- Portal给SP添加账户组
- Portal给SP删除账户组

## 具体接口
[点击查看API文档](https://apizza.net/pro/#/project/e8f5d608348d74235241bf1fba6fc69b/browse)

密码：hy-portal-api-doc

## 常见问题
### Ｑ：账户同步的两种方式是什么？有什么区别？
Ａ：Portal平台支持以下两种账户同步方式：
- 业务系统通过Portal提供的基于SCIM协议的接口将账户同步到Portal平台。
- Portal平台通过应用系统（SP）提供的接口将在Portal中创建的接口同步到SP中。

这两种方式的区别在于谁接收传过来的账户、谁提供接口。

> ❓ **说明** 接口需基于SCIM协议开发。

### Ｑ：Portal推数据到SP的方式，是推送的增量数据还是全量数据？

Ａ：Portal推数据到SP的数据采用的是增量的方式

### Ｑ：Portal推数据到SP如何保证安全与数据事务性？

Ａ：Portal推数据到SP这种方式同支付回调场景原理一致，需要业务系统正确处理之后，响应成功的状态码（200），才会认为这是一次正常的回调并记录日志。

<font color=red>**注意：**</font>

1、同样的通知可能会多次发送给业务系统。业务系统必须能够正确处理重复的通知。

2、后台通知交互时，如果Portal收到业务的应答不符合规范或超时，Portal会判定本次通知失败，重新发送通知，直到成功为止（在通知一直不成功的情况下，Portal总共会发起多次通知，通知频率为15s/15s/30s/3m/10m/20m/30m/30m/30m/60m/3h/3h/3h/6h/6h - 总计 24h4m），但Portal不保证通知最终一定能成功。

3、因此出于对主数据事务性的安全考虑，Portal会在最后一次通知失败时记录事务日志，并对业务系统与业务系统IT管理员发起多维度（邮件、短信、系统消息等）的告警通知。并提供相关事务补偿机制与手动重新发起通知，业务系统处理成功并返回正确的应答之后（或业务系统IT管理员手动确认关闭本次事务之后），才会结束此次事务。

4、当收到通知进行处理时，首先检查对应业务数据的状态，判断该通知是否已经处理过，如果没有处理过再进行处理，如果处理过直接返回结果成功。在对业务数据进行状态检查和处理之前，要采用数据锁进行并发控制，以避免函数重入造成的数据混乱。